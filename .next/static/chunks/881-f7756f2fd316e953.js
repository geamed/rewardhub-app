"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[881],{5259:(e,s,t)=>{t.d(s,{_:()=>r});var r=function(e){return e.SUCCESS="success",e.ERROR="error",e.INFO="info",e}({})},7362:(e,s,t)=>{t.d(s,{A:()=>a});var r=t(7876),l=t(4232);let a=e=>{let{isOpen:s,onClose:t,onConfirm:a,title:n,children:d,confirmText:i="Confirm",cancelText:o="Cancel",confirmButtonClass:c="bg-red-600 hover:bg-red-700 focus:ring-red-500",cancelButtonClass:u="bg-slate-200 hover:bg-slate-300 text-slate-700 focus:ring-slate-400"}=e;return((0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return s&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,t]),s)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300 ease-in-out","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",onClick:t,children:(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl p-6 w-full max-w-md mx-4 transform transition-all duration-300 ease-in-out scale-100",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("h3",{id:"modal-title",className:"text-xl font-semibold text-slate-800",children:n}),(0,r.jsx)("button",{type:"button",className:"text-slate-400 bg-transparent hover:bg-slate-200 hover:text-slate-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center",onClick:t,"aria-label":"Close modal",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,r.jsx)("div",{className:"text-slate-600 mb-6",children:d}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row-reverse sm:justify-start gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"w-full sm:w-auto inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 sm:text-sm ".concat(c),children:i}),(0,r.jsx)("button",{type:"button",onClick:t,className:"w-full sm:w-auto inline-flex justify-center rounded-md border border-slate-300 shadow-sm px-4 py-2 text-base font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 sm:mt-0 sm:text-sm ".concat(u),children:o})]})]})}):null}},8881:(e,s,t)=>{t.r(s),t.d(s,{default:()=>d});var r=t(7876),l=t(4232),a=t(5259),n=t(7362);let d=e=>{let{getAllRequests:s,updateRequestStatus:t,addNotification:d}=e,[i,o]=(0,l.useState)([]),[c,u]=(0,l.useState)(!0),[x,m]=(0,l.useState)("Pending Review"),[b,h]=(0,l.useState)(null),[p,j]=(0,l.useState)(!1),[f,g]=(0,l.useState)(null),[y,N]=(0,l.useState)(""),[v,w]=(0,l.useState)(null),R=(0,l.useCallback)(async()=>{u(!0);try{let e=await s();o(e)}catch(e){console.error("AdminPage: Error fetching withdrawal requests:",e),d("Failed to load withdrawal requests.",a._.ERROR),o([])}finally{u(!1)}},[s,d]);(0,l.useEffect)(()=>{R()},[R]);let C=()=>{j(!1),g(null),N(""),w(null)},S=async()=>{if(!f)return;if(!y.trim())return void w("Rejection reason cannot be empty.");w(null),h(f.id);let e=f.points;await t(f.userId,f.id,"Rejected",y)?(d("Request ".concat(f.id.substring(0,8),"... rejected. ").concat("Rejected"!==f.status?"".concat(e," points refunded."):"Reason updated."),a._.SUCCESS),o(e=>e.map(e=>e.id===f.id&&e.userId===f.userId?{...e,status:"Rejected",rejection_reason:y}:e))):d("Failed to reject request ".concat(f.id.substring(0,8),"..."),a._.ERROR),h(null),C()},k=async(e,s)=>{h(s),await t(e,s,"Processed")?(d("Request ".concat(s.substring(0,8),"... status updated to Processed."),a._.SUCCESS),o(t=>t.map(t=>t.id===s&&t.userId===e?{...t,status:"Processed",rejection_reason:null}:t))):d("Failed to approve request ".concat(s.substring(0,8),"..."),a._.ERROR),h(null)},E=i.filter(e=>"all"===x||e.status===x);return(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Admin Withdrawal Requests"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"statusFilter",className:"mr-2",children:"Filter by Status:"}),(0,r.jsxs)("select",{id:"statusFilter",value:x,onChange:e=>m(e.target.value),className:"border rounded p-1",children:[(0,r.jsx)("option",{value:"all",children:"All"}),(0,r.jsx)("option",{value:"Pending Review",children:"Pending Review"}),(0,r.jsx)("option",{value:"Processed",children:"Processed"}),(0,r.jsx)("option",{value:"Rejected",children:"Rejected"})]})]}),c&&(0,r.jsx)("p",{children:"Loading requests..."}),!c&&0===E.length&&(0,r.jsx)("p",{children:"No withdrawal requests found for the selected filter."}),!c&&E.length>0&&(0,r.jsxs)("table",{className:"min-w-full bg-white",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"Request ID"}),(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"User ID"}),(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"User Email"})," ",(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"Amount (USD)"})," ",(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"Points"}),(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"Status"}),(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"Reason (if rejected)"}),(0,r.jsx)("th",{className:"py-2 px-4 border-b",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:E.map(e=>{var s;return(0,r.jsxs)("tr",{children:[" ",(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:e.id}),(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:e.userId}),(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:e.userEmail})," ",(0,r.jsxs)("td",{className:"py-2 px-4 border-b",children:["$",null==(s=e.amount_usd)?void 0:s.toFixed(2)]})," ",(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:e.points}),(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:e.status}),(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:e.rejection_reason}),(0,r.jsx)("td",{className:"py-2 px-4 border-b",children:"Pending Review"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>k(e.userId,e.id),disabled:b===e.id,className:"bg-green-500 text-white px-2 py-1 rounded mr-2 disabled:opacity-50",children:b===e.id?"Processing...":"Approve"}),(0,r.jsx)("button",{onClick:()=>(e=>{g(e),N(e.rejection_reason||""),w(null),j(!0)})(e),disabled:b===e.id,className:"bg-red-500 text-white px-2 py-1 rounded disabled:opacity-50",children:"Reject"})]})})]},e.id)})})]}),(0,r.jsx)(n.A,{isOpen:p,onClose:C,onConfirm:S,title:"Reject Withdrawal Request",confirmText:"Confirm Rejection",confirmButtonClass:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:f&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"mb-4",children:["Rejecting request ID: ",f.id]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"rejectionReason",className:"block mb-2",children:"Reason for Rejection:"}),(0,r.jsx)("textarea",{id:"rejectionReason",rows:4,className:"w-full border rounded p-2 ".concat(v?"border-red-500":""),value:y,onChange:e=>N(e.target.value)}),v&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v})]}),(0,r.jsxs)("div",{className:"flex justify-end",children:[(0,r.jsx)("button",{onClick:C,className:"bg-gray-300 text-gray-800 px-4 py-2 rounded mr-2",children:"Cancel"}),(0,r.jsx)("button",{onClick:S,disabled:!y.trim()||b===f.id,className:"bg-red-500 text-white px-4 py-2 rounded disabled:opacity-50",children:b===f.id?"Submitting...":"Confirm Rejection"})]})]})})]})}}}]);